(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[915],{40168:function(e,s,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/config-cluster",function(){return r(40309)}])},40309:function(e,s,r){"use strict";r.r(s);var n=r(85893),t=r(74905),o=r(67294),i=r(87536),c=r(25934),a=r(79124),l=r(63792),d=r(72534),u=r(79225),x=r(11163),h=r(43080),p=r(8507),f=r(48847);function m(e,s){(null==s||s>e.length)&&(s=e.length);for(var r=0,n=new Array(s);r<s;r++)n[r]=e[r];return n}function v(e,s,r){return s in e?Object.defineProperty(e,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[s]=r,e}function g(e){for(var s=1;s<arguments.length;s++){var r=null!=arguments[s]?arguments[s]:{},n=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(s){v(e,s,r[s])}))}return e}function j(e){return function(e){if(Array.isArray(e))return m(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,s){if(!e)return;if("string"===typeof e)return m(e,s);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return m(e,s)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var b=function(){var e=(0,u.o)((function(e){return e.clusterDefinition})),s=(0,i.cI)({mode:"onChange",defaultValues:{operators:h.fI,singleAddress:"",feeRecipientAddress:"",enr:"",name:""}}),r=s.control,m=s.register,b=s.handleSubmit,y=s.formState,C=(y.errors,y.isDirty),k=y.isValid,w=s.resetField,$=s.setValue,S=s.trigger,A=s.getValues,N=(0,i.Dq)({control:r,name:"operators"}),E=N.fields,T=N.append,I=N.remove,O=(0,x.useRouter)(),R=(0,u.o)((function(e){return e.completeLeaderStep})),z=(0,u.o)((function(e){return e.enableLeaderStep})),V=(0,u.o)((function(e){return e.updateClusterDefinition})),_=(0,o.useState)(0),D=_[0],F=_[1],P=(0,d.kR)().account,W=(0,d.pZ)(P),Z=(0,o.useState)((null===e||void 0===e?void 0:e.nonOperatorFlag)||!1),G=Z[0],K=Z[1],q=(0,d.D9)(G),U=(0,o.useState)((null===e||void 0===e?void 0:e.clusterSize)||4),H=U[0],J=U[1],L=(0,d.D9)(H),Q=(0,o.useState)((null===e||void 0===e?void 0:e.validatorsSize)||1),B=Q[0],M=Q[1],X=(0,o.useState)("single"),Y=X[0],ee=X[1],se=(0,o.useState)(h.IK),re=se[0],ne=se[1],te=(0,o.useState)(),oe=te[0],ie=te[1],ce=(0,o.useState)(!1),ae=ce[0],le=ce[1],de=(0,o.useState)(),ue=de[0],xe=de[1];return(0,o.useEffect)((function(){B&&ie(32*B)}),[B]),(0,o.useEffect)((function(){if(Y)if(w("singleAddress"),Y===p.RJ.splitter){var e=!re.some((function(e){return null===e.operator||""===e.operator||null===e.split||0===e.split})),s=!re.some((function(e){return/^0x[a-fA-F0-9]{40}$/.test(e.operator)}));le(0!==re.length&&(e&&!s))}else le(!0)}),[Y,w,re]),(0,o.useEffect)((function(){if(re){var e=re.reduce((function(e,s){return s.split?s.split+e:e}),0);F(e)}}),[re]),(0,o.useEffect)((function(){if(H){var e=(0,f.zT)(H);xe(e)}L&&L<H&&T({address:""},{shouldFocus:!1}),L&&L>H&&I(H-1)}),[L,H]),(0,o.useEffect)((function(){G&&T({address:""},{shouldFocus:!1}),1!=q||G||I(A().operators.length-1)}),[G]),(0,o.useEffect)((function(){$("singleAddress",null===e||void 0===e?void 0:e.singleAddress),$("feeRecipientAddress",null===e||void 0===e?void 0:e.feeRecipientAddress),$("enr",null===e||void 0===e?void 0:e.enr),$("name",null===e||void 0===e?void 0:e.name),(null===e||void 0===e?void 0:e.operators)&&$("operators",null===e||void 0===e?void 0:e.operators)}),[]),(0,n.jsxs)(a.kC,{direction:"column",css:{gap:"$2xl"},children:[(0,n.jsx)(t.xv,{variant:"h3",children:"Configure Cluster"}),(0,n.jsx)(a.l0,{onSubmit:b((function(e){R("config-cluster"),V(g({},e,{creator:{address:P},withdrawalAddresses:re,validatorsEthAmount:oe,nonOperatorFlag:G}));var s=z("confirm-configuration");O.push(s.href)})),children:(0,n.jsxs)(a.kC,{direction:"column",css:{gap:"$2xl"},children:[(0,n.jsx)(t.W2,{className:"cluster-details",alignItems:"start",children:(0,n.jsxs)(a.kC,{direction:"column",css:{gap:"$2xl"},children:[(0,n.jsx)(t.xv,{variant:"h4",children:"Cluster Details"}),(0,n.jsxs)(a.kC,{direction:"column",className:"cluster-name-section",css:{gap:"$sm"},children:[(0,n.jsx)(t.xv,{css:{textTransform:"uppercase"},variant:"subline",color:"body",children:"Cluster Name"}),(0,n.jsx)(t.xv,{variant:"metadata",color:"muted",children:"Used to identify your group during configuration process"}),(0,n.jsx)(t.nv,g({},m("name",{required:!0}),{placeholder:"Super Validators",defaultValue:null===e||void 0===e?void 0:e.name}))]}),(0,n.jsxs)(a.kC,{direction:{"@sm":"column"},className:"cluster-size-section",css:{gap:"$3xl"},children:[(0,n.jsxs)(a.kC,{direction:"column",css:{gap:"$sm",width:"auto"},children:[(0,n.jsxs)(a.kC,{css:{alignItems:"center",gap:"$xxxs"},children:[(0,n.jsx)(t.xv,{css:{textTransform:"uppercase"},variant:"subline",color:"body",children:"Cluster Size"}),(0,n.jsx)(t.KZ,{content:"Cluster Size: The number of operators in the cluster. The minimum is 4, for now the maximum is capped at 15.",children:(0,n.jsx)(t.xu,{css:{display:"flex"},children:(0,n.jsx)(t.by,{})})})]}),(0,n.jsx)(l.fx,{name:"clusterSize",value:H,control:r,onChangeValue:function(e){return J(e)},min:4})]}),(0,n.jsxs)(a.kC,{direction:"column",css:{gap:"$sm",width:"auto"},children:[(0,n.jsxs)(a.kC,{css:{alignItems:"center",gap:"$xxxs"},children:[(0,n.jsx)(t.xv,{css:{textTransform:"uppercase"},variant:"subline",color:"body",children:"Threshold"}),(0,n.jsx)(t.KZ,{content:"Threshold: The number of nodes that need to be functioning for the validator to stay active.",children:(0,n.jsx)(t.xu,{css:{display:"flex"},children:(0,n.jsx)(t.by,{})})})]}),(0,n.jsx)(a.kC,{css:{height:"100%",alignItems:"center"},children:(0,n.jsx)(t.xv,{variant:"h5",css:{color:"$body"},children:"".concat(ue,"/").concat(H)})})]}),(0,n.jsxs)(a.kC,{direction:"column",css:{gap:"$sm",width:"auto"},children:[(0,n.jsxs)(a.kC,{css:{alignItems:"center",gap:"$xxxs"},children:[(0,n.jsx)(t.xv,{css:{textTransform:"uppercase"},variant:"subline",color:"body",children:"Non operator"}),(0,n.jsx)(t.KZ,{content:"A flag to indicate you are not an operator in the cluster.",children:(0,n.jsx)(t.xu,{css:{display:"flex"},children:(0,n.jsx)(t.by,{})})})]}),(0,n.jsx)(a.kC,{css:{height:"100%",alignItems:"center"},children:(0,n.jsx)(t.rs,{checked:G,onCheckedChange:function(){K(!G)}})})]})]}),(0,n.jsxs)(a.kC,{direction:"column",className:"operator-address-section",css:{gap:"$sm"},children:[(0,n.jsx)(t.xv,{css:{textTransform:"uppercase"},variant:"subline",color:"body",children:"Your Address"}),(0,n.jsxs)(a.kC,{direction:"column",css:{gap:"$xxxs"},children:[W&&(0,n.jsx)(t.xv,{color:"white",children:W}),(0,n.jsx)(t.xv,{color:"obolGreen",children:P})]})]}),E.map((function(e,s){return(0,n.jsx)(a.kC,{direction:"column",css:{gap:"$sm","& div > input":{color:"$obolGreen"}},children:(0,n.jsx)(l.Cf,{control:r,label:"Operator ".concat(G?s+1:s+2),name:"operators.".concat(s,".address"),operatorsAddresses:A().operators,index:s})},":op".concat(e&&e.id,":"))})),(0,n.jsxs)(a.kC,{direction:"column",className:"operator-address-section",css:{gap:"$sm"},children:[(0,n.jsx)(t.xv,{css:{textTransform:"uppercase"},variant:"subline",color:"body",children:"Cluster Created By"}),(0,n.jsx)(t.xv,{color:"obolGreen",children:P})]})]})}),(0,n.jsxs)(t.W2,{className:"validators-section",alignItems:"start",children:[(0,n.jsxs)(a.kC,{direction:"column",css:{gap:"$xxxs"},children:[(0,n.jsx)(t.xv,{variant:"h4",children:"Validators"}),(0,n.jsx)(t.xv,{size:"4",color:"muted",children:"Select how many full ETH validators you want to run."})]}),(0,n.jsxs)(a.kC,{direction:{"@sm":"column"},css:{gap:"$xl",width:"auto"},children:[(0,n.jsxs)(a.kC,{direction:"column",css:{gap:"$xs"},children:[(0,n.jsx)(t.xv,{css:{textTransform:"uppercase"},variant:"subline",color:"body",children:"Validators"}),(0,n.jsx)(l.fx,{value:B,onChangeValue:function(e){M(Number(e))},name:"validatorsSize",control:r,max:250})]}),(0,n.jsxs)(a.kC,{direction:"column",css:{gap:"$xs"},children:[(0,n.jsx)(t.xv,{css:{textTransform:"uppercase"},variant:"subline",color:"body",children:"Cost"}),(0,n.jsxs)(a.kC,{css:{gap:"$xxs",height:"100%",alignItems:"center"},children:[(0,n.jsx)(t.Ee,{src:"/assets/eth-icon.svg",alt:"eth",width:24,height:24}),(0,n.jsxs)(t.xv,{css:{textTransform:"uppercase"},variant:"h5",children:[oe," Eth"]})]})]})]})]}),!G&&(0,n.jsxs)(t.W2,{className:"enr-section",alignItems:"start",css:{gap:"$lg"},children:[(0,n.jsxs)(a.kC,{direction:"column",css:{gap:"$sm"},children:[(0,n.jsxs)(a.kC,{css:{alignItems:"center",gap:"$xxxs"},children:[(0,n.jsx)(t.xv,{variant:"subline",color:"body",css:{textTransform:"uppercase"},children:"What is your Charon Client's ENR?"}),(0,n.jsx)(t.KZ,{content:"An ENR is a public key and encoded networking info starting with enr:-...",children:(0,n.jsx)(t.xu,{css:{display:"flex"},children:(0,n.jsx)(t.by,{})})})]}),(0,n.jsx)(l.iA,{control:r,name:"enr"})]}),(0,n.jsxs)(t.rU,{href:"https://docs.obol.tech/docs/next/int/faq/errors#enrs-keys",target:"_blank",children:["More on Ethereum Node Records ",(0,n.jsx)(t.ZJ,{})]})]}),(0,n.jsxs)(t.W2,{className:"withdrawal-section",css:{gap:"$xl"},alignItems:"start",children:[(0,n.jsx)(t.xv,{variant:"h4",children:"Withdrawal Address"}),(0,n.jsx)(t.Hc,{value:Y,onValueChange:function(e){return ee(p.RJ[e])},defaultValue:"single","aria-label":"View density",children:(0,n.jsx)(a.kC,{direction:{"@sm":"column"},css:{width:"$full",gap:"$sm"},children:(0,n.jsxs)(t.xu,{css:{display:"flex",margin:"10px 0",alignItems:"center"},children:[(0,n.jsx)(t.Wr,{value:"single",id:"r2",children:(0,n.jsx)(t.Q4,{})}),(0,n.jsx)(t.qH,{htmlFor:"r2",css:{fontWeight:"$bold",color:"$light"},children:"Single Address"})]})})}),"splitter"===Y?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.xv,{color:"body",variant:"body",children:"Enter each recipient\u2019s address and their share. Ownership must\n                add to 100%."}),(0,n.jsx)(t.xv,{color:"body",variant:"body",children:" By default, the Operator addresses are pre-filled,\n                and an optional 1% of rewards are allocated to be used by Obol\n                for Public Goods."}),(0,n.jsx)(t.Cl,{columns:h.Ae,rows:re,onAddRow:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:(0,c.Z)(),operator:null,split:null};ne(j(re).concat([e]))},onRemoveRow:function(e){ne(re.filter((function(s){return s.id!==e})))},onUpdateRow:function(e,s,r){ne(re.map((function(n){return n.id===e?g({},n,v({},r,s)):g({},n)})))},totalSplitFooter:D}),!ae&&(0,n.jsx)(t.xv,{variant:"metadata",color:"test",children:"Please enter valid wallet address or set the split %"})]}):(0,n.jsxs)(a.kC,{direction:"column",className:"single-address-section",css:{gap:"$sm"},children:[(0,n.jsxs)(a.kC,{css:{justifyContent:"space-between"},children:[(0,n.jsx)(t.xv,{color:"body",variant:"body",children:"Address to receive validator principal and rewards at exit"}),(0,n.jsx)(t.zx,{ghost:!0,css:{color:"$obolGreen",fontSize:"$1",p:0,height:"100%"},onClick:function(e){e.preventDefault(),$("singleAddress",P),S("singleAddress")},children:"Same as my wallet address"})]}),(0,n.jsx)(l.bQ,{control:r,name:"singleAddress"})]})]}),(0,n.jsxs)(t.W2,{className:"fee-recipient-section",css:{gap:"$xl"},alignItems:"start",children:[(0,n.jsx)(t.xv,{variant:"h4",children:"Fee Recipient"}),(0,n.jsxs)(a.kC,{direction:"column",className:"fee-recipient-address-section",css:{gap:"$sm"},children:[(0,n.jsxs)(a.kC,{css:{justifyContent:"space-between"},children:[(0,n.jsx)(t.xv,{color:"body",variant:"body",children:"Address to receive transaction fees from block proposals."}),(0,n.jsx)(t.zx,{ghost:!0,css:{color:"$obolGreen",fontSize:"$1",p:0,height:"100%"},onClick:function(e){e.preventDefault(),$("feeRecipientAddress",P),S("feeRecipientAddress")},children:"Same as my wallet address"})]}),(0,n.jsx)(l.bQ,{control:r,name:"feeRecipientAddress"})]})]}),(0,n.jsx)(a.kC,{direction:"column",children:(0,n.jsx)(t.zx,{color:"primary",type:"submit",disabled:!C||!k||!ae||!P,children:"Create Cluster Configuration"})})]})})]})};s.default=b,b.layout="ProgressTrackerLayout"}},function(e){e.O(0,[880,536,380,805,419,774,888,179],(function(){return s=40168,e(e.s=s);var s}));var s=e.O();_N_E=s}]);